<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Clock</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-12" id="clock-border">
          <section id="clock">
            <div id="lights-display">
              <div class="row">
                <div class="col-6">
                  <div class="light-wrapper">
                    <div class="light-cover"></div><div id="work-light" class="light" >WORK</div>
                  </div>
                </div>
                <div class="col-6">     
                  <div class="light-wrapper">
                    <div class="light-cover"></div><div id="rest-light" class="light" >REST</div>
                  </div>                  
                </div>                      
              </div>
            </div>
            <div id="clock-display">
              <span id="min-10s" class="time-display">0</span>
              <span id="min-1s" class="time-display">0</span></span>
              <span class="time-display" class="time-display">:</span>
              <span id="sec-10s" class="time-display">0</span></span>
              <span id="sec-1s" class="time-display">0</span>
            </div>          
            <div id="control-panel">
              Task
              <input id="work" type="number" value="45" placeholder="Enter work time in seconds" >
              Rest
              <input id="rest" type="number" value="15" placeholder="Enter rest time in seconds" >            
              <button id="start" >start</button>  
            </div>
          </section>
        </div>               
      </div>
    </div>
    <script>
      var start = document.getElementById('start');
      var work = document.getElementById('work');
      var rest = document.getElementById('rest');
      var min10s = document.getElementById('min-10s');
      var min1s = document.getElementById('min-1s');
      var sec10s = document.getElementById('sec-10s');
      var sec1s = document.getElementById('sec-1s');
      var workLight = document.getElementById('work-light');
      var restLight = document.getElementById('rest-light');

      function displayTime(arr){
        min10s.innerHTML = arr[0];
        min1s.innerHTML = arr[1];
        sec10s.innerHTML = arr[2];
        sec1s.innerHTML = arr[3];
      }


      function parseCounter(counter){

        var time = ['0', '0', '0', '0'];
        var str;
        var mod;
        
        if (counter - 10 < 0){
          time[3] = String(counter);
        }
        else if (counter - 10 > -1 && counter - 60 < 0) {
          str = String(counter);
          time[2] = str[0];
          time[3] = str[1];
        }
        else if (counter >= 60 && counter < 600){
          time[1] = String(Math.floor(counter/60));
          mod = counter % 60;
          if (mod < 10){
            time[3] = String(mod);
          } else {
            mod = String(mod);
            time[2] = mod[0];
            time[3] = mod[1];
          }  
        }
        else {
          var mod = counter % 60;
          if (mod < 10){
            time[1] = String(mod);
          } else {
            mod = String(mod);
            time[0] = mod[0];
            time[1] = mod[1];
          }  
        }

        return time;
      }

      var timekeeper = {
        counter: 1,
        work: {
          duration: 10,
        },
        rest: {
          duration: 5,
        },
        phases: ['work', 'rest'],
        timer: undefined,
        cb: function(){
          workLight.classList.toggle('light-on');
          restLight.classList.toggle('light-on');
        }
      }
      var timer = pomodoro(timekeeper)

      start.addEventListener("click", function(){
        timer.setDurations(work.value, rest.value);
        timer.start();
      })

      function pomodoro(timekeeper) {

        var obj = Object.assign({}, timekeeper);
        var phase = obj.phases.shift();
        var _initial = obj.counter;
        obj.phases.push(phase);

        return {
          setDurations: function setDurations(t, r){
            obj.work.duration = Number(t);
            obj.rest.duration = Number(r);
          },
          start: function start(){
            obj.counter = _initial;
            
            if (obj.timer !== undefined){
              clearInterval(obj.timer);
            }

            displayTime(['0', '0', '0', '1']);

            restLight.classList.remove('light-on');
            workLight.classList.add('light-on');
            

            obj.timer = setInterval(function timerFn() {
              
              if (obj.counter >= obj[phase].duration){
                phase = obj.phases.shift();
                obj.phases.push(phase);
                obj.counter = 0;
                obj.cb();
              }

              obj.counter++;
              displayTime(parseCounter(obj.counter));
              return timerFn;
            }, 1000);
          }
        }
      }

    </script>
  </body>
</html>